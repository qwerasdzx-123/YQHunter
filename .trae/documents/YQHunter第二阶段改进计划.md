# YQHunter第二阶段改进计划

## 一、当前状态分析

根据深度分析报告和代码检查，第一阶段的部分改进已经完成：
- ✅ CLI调度器已使用scanner.RunScan的并发机制
- ✅ 模块间数据流已打通，爬虫结果已传递给后续扫描模块
- ✅ 已实现速率限制器

## 二、第二阶段改进目标

按照深度分析报告的要求，第二阶段需要完成以下改进：
1. 改进XSS扫描逻辑，减少误报，提高检测准确率
2. 完善SSRF扫描功能，支持POST请求和JSON格式
3. 统一HTTP客户端管理，共享连接池

## 三、详细改进方案

### 1. 改进XSS扫描逻辑

**当前状态**：已实现基于上下文的XSS检测，但仍有优化空间

**改进内容**：
- 修复detectXSSInResponse函数中的语法错误（第457行多余的右括号）
- 完善不同上下文的检测逻辑，提高检测准确率
- 添加payload分级和严重性评估
- 支持更多XSS上下文类型

**实施步骤**：
1. 修复detectXSSInResponse函数的语法错误
2. 改进HTML上下文检测，支持更多HTML标签和属性
3. 增强JavaScript上下文检测，支持更多JavaScript执行场景
4. 添加CSS上下文检测的完整实现
5. 优化URL上下文检测，支持更多URL格式

### 2. 完善SSRF扫描功能

**当前状态**：已实现GET请求测试，但需要支持POST请求和JSON格式

**改进内容**：
- 支持POST请求和JSON格式测试
- 添加OOB回调支持
- 测试不同类型的SSRF漏洞
- 支持更多参数名测试

**实施步骤**：
1. 实现POST请求测试逻辑
2. 支持JSON格式请求
3. 添加OOB回调机制
4. 扩展测试参数名列表
5. 完善SSRF检测逻辑

### 3. 统一HTTP客户端管理

**当前状态**：已创建internal/httpclient包，但需要检查各模块的使用情况

**改进内容**：
- 确保所有模块使用统一的HTTP客户端
- 优化连接池配置
- 确保连接复用率达到80%+

**实施步骤**：
1. 检查各模块的HTTP客户端使用情况
2. 确保所有模块使用internal/httpclient包
3. 优化连接池配置参数
4. 测试连接复用率

## 四、验证方法

1. **XSS扫描逻辑改进验证**：
   - 使用已知XSS漏洞进行测试
   - 统计误报率和漏报率
   - 对比改进前后的检测结果

2. **SSRF扫描功能完善验证**：
   - 使用已知SSRF漏洞进行测试
   - 测试不同请求方式和格式
   - 统计检测率

3. **HTTP客户端统一管理验证**：
   - 检查连接复用率
   - 对比内存占用
   - 测试并发性能

## 五、预期效果

- 漏洞检测率提升50-100%
- 误报率降低70%
- 连接复用率达到80%+
- 支持更多漏洞类型和检测场景

## 六、实施顺序

1. 修复XSS扫描逻辑的语法错误
2. 完善SSRF扫描功能，支持POST请求和JSON格式
3. 优化XSS扫描逻辑，提高检测准确率
4. 检查并统一HTTP客户端管理
5. 进行全面测试和验证

通过以上改进，将使YQHunter成为一个更强大、更可靠的Web安全扫描工具，提高其性能、功能和可维护性。